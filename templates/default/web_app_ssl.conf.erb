<VirtualHost *:80>
  <IfModule mod_http2.c>
  Protocols h2c http/1.1
  </IfModule>
  DocumentRoot <%= @params[:docroot] %>
  <Directory <%= @params[:docroot] %>>
    Options +FollowSymLinks +ExecCGI
    AllowOverride All
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    <IfModule !mod_authz_core.c>
        Allow from All
    </IfModule>
  </Directory>
</VirtualHost>

<VirtualHost *:443>
  <IfModule mod_http2.c>
  Protocols h2 http/1.1
  </IfModule>
  DocumentRoot <%= @params[:docroot] %>
  <Directory <%= @params[:docroot] %>>
    Options +FollowSymLinks +ExecCGI
    AllowOverride All
    <IfModule mod_authz_core.c>
        Require all granted
    </IfModule>
    <IfModule !mod_authz_core.c>
        Allow from All
    </IfModule>
  </Directory>

    SSLEngine on
    SSLProxyEngine on
    SSLCertificateFile /etc/apache2/ssl/<%= @params[:server_name] %>.crt
    SSLCertificateKeyFile /etc/apache2/ssl/<%= @params[:server_name] %>.key
    SSLCACertificateFile /etc/apache2/ssl/<%= @params[:server_name] %>_ca.crt

    SetEnvIf User-Agent ".*MSIE.*" nokeepalive ssl-unclean-shutdown downgrade-1.0 force-response-1.0

</VirtualHost>
